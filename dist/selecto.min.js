/*
Copyright (c) 2019 Daybrush
name: selecto
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/selecto.git
version: 0.0.25
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@egjs/component"),require("@daybrush/drag"),require("framework-utils"),require("@daybrush/utils"),require("@egjs/children-differ"),require("@scena/dragscroll"),require("keycon"),require("css-styled")):"function"==typeof define&&define.amd?define(["@egjs/component","@daybrush/drag","framework-utils","@daybrush/utils","@egjs/children-differ","@scena/dragscroll","keycon","css-styled"],e):(t=t||self).Selecto=e(t.Component,t.Dragger,t.frameworkUtils,t.utils,t.ChildrenDiffer,t.DragScroll,t.KeyController,t.styled)}(this,function(t,s,a,f,p,l,c,e){"use strict";var u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var d=function(){return(d=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function g(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=e||{},i=o.className,s=o.style;return{tag:t,className:void 0===i?"":i,style:void 0===s?{}:s,attributes:function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(o,["className","style"]),children:n}}function h(t,e,n){t!==e&&n(t,e)}var y=e("\n:host {\n    position: fixed;\n    display: none;\n    border: 1px solid #4af;\n    background: rgba(68, 170, 255, 0.5);\n    z-index: 100;\n}\n"),v="selecto-selection "+y.className,n={target:null,container:null,dragContainer:null,selectableTargets:Array,selectByClick:Boolean,selectFromInside:Boolean,continueSelect:Boolean,toggleContinueSelect:Array,keyContainer:null,hitRate:Number,scrollOptions:Object},m=["selectableTargets","selectByClick","selectFromInside","continueSelect","toggleContinueSelect","keyContainer","hitRate","scrollOptions"],r=function(e){function t(){this.constructor=n}var n,r;function o(t){void 0===t&&(t={});var y=e.call(this)||this;return y.selectedTargets=[],y.differ=new p,y.dragScroll=new l,y.onDragStart=function(t,e){var n=t.datas,r=t.clientX,o=t.clientY,i=t.inputEvent,s=y.options,a=s.continueSelect,l=s.selectFromInside,c=y.getSelectableTargets(),u=c.map(function(t){var e=t.getBoundingClientRect(),n=e.left,r=e.top;return{left:n,top:r,right:n+e.width,bottom:r+e.height}});n.selectableTargets=c,n.selectableRects=u,n.startSelectedTargets=y.selectedTargets;var d=e||document.elementFromPoint(r,o),g=y.hitTest({left:r,top:o,right:r,bottom:o},r,o,c,u).filter(function(t){return t===d||t.contains(d)}),f=0<g.length;a?g=y.getSelectedTargets(g):y.selectedTargets=[];var h=i.type;if(!(!("mousedown"===h||"touchstart"===h)||y.trigger("dragStart",t)))return!1;if(y.select(g,i,!0),n.startX=r,n.startY=o,n.selectedTargets=g,y.target.style.cssText+="left:"+r+"px;top:"+o+"px",!l&&f)return y.onDragEnd(t),i.preventDefault(),!1;var p=y.options.scrollOptions;return p&&y.dragScroll.dragStart(p.container),!0},y.onDrag=function(t){var e=t.distX,n=t.distY,r=t.datas,o=t.inputEvent,i=r.startX,s=r.startY,a=Math.min(0,e),l=Math.min(0,n),c=Math.abs(e),u=Math.abs(n);y.target.style.cssText+="display: block;left:"+i+"px;top:"+s+"px;transform: translate("+a+"px, "+l+"px);width:"+c+"px;height:"+u+"px;";var d=i+a,g=s+l,f=y.hitTest({left:d,top:g,right:d+c,bottom:g+u},r.startX,r.startY,r.selectableTargets,r.selectableRects),h=y.getSelectedTargets(f),p=y.options.scrollOptions;p&&(y.dragScroll.drag(t,p),y.dragScroll.dragAfter(t,p)),y.select(h,o),r.selectedTargets=h},y.onDragEnd=function(t){var e=t.datas,n=t.inputEvent;y.target.style.cssText+="display: none;",y.selecteEnd(e.startSelectedTargets,e.selectedTargets,n),y.selectedTargets=e.selectedTargets},y.onKeyDown=function(t){y.sameCombiKey(t)&&(y.continueSelect=!0,y.trigger("keydown",{}))},y.onKeyUp=function(t){y.sameCombiKey(t)&&(y.continueSelect=!1,y.trigger("keyup",{}))},y.onBlur=function(){y.toggleContinueSelect&&y.continueSelect&&y.trigger("keyup",{})},y.onDocumentSelectStart=function(t){if(y.dragger.isFlag()){var e=y.dragContainer;e===window&&(e=document.documentElement),e!==t.target&&!e.contains(t.target)||t.preventDefault()}},y.target=t.target,y.container=t.container,y.options=d({target:null,container:null,dragContainer:null,selectableTargets:[],selectByClick:!0,selectFromInside:!0,hitRate:100,continueSelect:!1,toggleContinueSelect:null,keyContainer:null,scrollOptions:void 0},t),y.initElement(),y.initDragScroll(),y.setKeyController(),y}u(n=o,r=e),n.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t);var i=o.prototype;return i.setSelectedTargets=function(t){this.selectedTargets=t,this.differ=new p(t)},i.setKeyContainer=function(t){var e=this,n=this.options;h(n.keyContainer,t,function(){n.keyContainer=t,e.setKeyController()})},i.setToggleContinueSelect=function(t){var e=this,n=this.options;h(n.toggleContinueSelect,t,function(){n.toggleContinueSelect=t,e.setKeyEvent()})},i.destroy=function(){this.off(),this.keycon&&this.keycon.destroy(),this.dragger.unset(),this.injectResult.destroy(),f.removeEvent(document,"selectstart",this.onDocumentSelectStart),this.keycon=null,this.dragger=null,this.injectResult=null,this.target=null,this.container=null,this.options=null},i.click=function(t,e){var n=function(t){if("touches"in t){var e=t.touches[0];return{clientX:e.clientX,clientY:e.clientY}}return{clientX:t.clientX,clientY:t.clientY}}(t),r={datas:{},clientX:n.clientX,clientY:n.clientY,inputEvent:t};this.onDragStart(r,e)&&this.onDragEnd(r)},i.setKeyController=function(){var t=this.options,e=t.keyContainer,n=t.toggleContinueSelect;this.keycon&&(this.keycon.destroy(),this.keycon=null),n&&(this.keycon=new c(e||window),this.keycon.keydown(this.onKeyDown).keyup(this.onKeyUp).on("blur",this.onBlur))},i.setKeyEvent=function(){this.options.toggleContinueSelect&&!this.keycon&&this.setKeyController()},i.initElement=function(){this.target=function n(t,e,r){var o=t.tag,i=t.children,s=t.attributes,a=t.className,l=t.style,c=e||document.createElement(o);for(var u in s)c.setAttribute(u,s[u]);var d=c.children;if(i.forEach(function(t,e){n(t,d[e],c)}),a&&a.split(" ").forEach(function(t){f.hasClass(c,t)||f.addClass(c,t)}),l){var g=c.style;for(var u in l)g[u]=l[u]}return!e&&r&&r.appendChild(c),c}(g("div",{className:v}),this.target,this.container);var t=this.target;this.dragContainer=this.options.dragContainer||this.target.parentNode,this.dragger=new s(this.dragContainer,{container:window,preventDefault:!1,dragstart:this.onDragStart,drag:this.onDrag,dragend:this.onDragEnd}),f.addEvent(document,"selectstart",this.onDocumentSelectStart),this.injectResult=y.inject(t)},i.hitTest=function(t,f,h,p,e){var n=this.options,y=n.hitRate,v=n.selectByClick,m=t.left,S=t.top,b=t.right,C=t.bottom,E=[];return e.forEach(function(t,e){var n=t.left,r=t.top,o=t.right,i=t.bottom,s=n<=f&&f<=o&&r<=h&&h<=i,a=(o-n)*(i-r),l=Math.max(n,m),c=Math.min(o,b),u=Math.max(r,S),d=Math.min(i,C);if(v&&s)E.push(p[e]);else if(!(c<l||d<u)){var g=Math.round((c-l)*(d-u)/a*100);y<=g&&E.push(p[e])}}),E},i.initDragScroll=function(){var i=this;this.dragScroll.on("scroll",function(t){var e=t.container,n=t.direction;i.trigger("scroll",{container:e,direction:n})}).on("move",function(t){var e=t.offsetX,n=t.offsetY,r=t.inputEvent,o=r.datas;o.startX-=e,o.startY-=n,o.selectableRects.forEach(function(t){t.top-=n,t.bottom-=n,t.left-=e,t.right-=e}),i.dragger.scrollBy(e,n,r.inputEvent,!1)})},i.getSelectableTargets=function(){var e=[];return this.options.selectableTargets.forEach(function(t){f.isObject(t)?e.push(t):[].slice.call(document.querySelectorAll(t)).forEach(function(t){e.push(t)})}),e},i.getSelectedTargets=function(t){var e=p.diff(this.selectedTargets,t),n=e.list,r=e.prevList,o=e.added,i=e.removed;return o.map(function(t){return n[t]}).concat(i.map(function(t){return r[t]}))},i.select=function(t,e,n){var r=this.differ.update(t),o=r.added,i=r.removed,s=r.prevList,a=r.list;n&&this.trigger("selectStart",{selected:t,added:o.map(function(t){return a[t]}),removed:i.map(function(t){return s[t]}),inputEvent:e}),(o.length||i.length)&&this.trigger("select",{selected:t,added:o.map(function(t){return a[t]}),removed:i.map(function(t){return s[t]}),inputEvent:e})},i.selecteEnd=function(t,e,n){var r=p.diff(t,e),o=r.added,i=r.removed,s=r.prevList,a=r.list,l=p.diff(this.selectedTargets,e),c=l.added,u=l.removed,d=l.prevList,g=l.list,f=n.type,h="mousedown"===f||"touchstart"===f;this.trigger("selectEnd",{selected:e,added:o.map(function(t){return a[t]}),removed:i.map(function(t){return s[t]}),afterAdded:c.map(function(t){return g[t]}),afterRemoved:u.map(function(t){return d[t]}),isDragStart:h,inputEvent:n})},i.sameCombiKey=function(t){var e=[].concat(this.options.toggleContinueSelect),n=c.getCombi(t.inputEvent,t.key);return e.every(function(t){return-1<n.indexOf(t)})},o=function(t,e,n,r){var o,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;0<=a;a--)(o=t[a])&&(s=(i<3?o(s):3<i?o(e,n,s):o(e,n))||s);return 3<i&&s&&Object.defineProperty(e,n,s),s}([a.Properties(m,function(t,e){var n={enumerable:!0,configurable:!0,get:function(){return this.options[e]}},r=f.camelize("set "+e);t[r]?n.set=function(t){this[r](t)}:n.set=function(t){this.options[e]=t},Object.defineProperty(t,e,n)})],o)}(t),o={__proto__:null,default:r,OPTIONS:["dragContainer","selectableTargets","selectByClick","selectFromInside","continueSelect","toggleContinueSelect","keyContainer","hitRate","scrollOptions"],OPTION_TYPES:n,PROPERTIES:m,EVENTS:["dragStart","selectStart","select","selectEnd","keydown","keyup"],METHODS:["click","setSelectedTargets"],CLASS_NAME:v};for(var i in o)r[i]=o[i];return r});
//# sourceMappingURL=selecto.min.js.map
