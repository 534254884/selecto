/*
Copyright (c) 2019 Daybrush
name: selecto
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/selecto.git
version: 0.0.24
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@egjs/component"),require("@daybrush/drag"),require("framework-utils"),require("@daybrush/utils"),require("@egjs/children-differ"),require("keycon"),require("css-styled")):"function"==typeof define&&define.amd?define(["@egjs/component","@daybrush/drag","framework-utils","@daybrush/utils","@egjs/children-differ","keycon","css-styled"],t):(e=e||self).Selecto=t(e.Component,e.Dragger,e.frameworkUtils,e.utils,e.ChildrenDiffer,e.KeyController,e.styled)}(this,function(e,s,a,f,y,l,t){"use strict";var c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function d(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=t||{},i=o.className,s=o.style;return{tag:e,className:void 0===i?"":i,style:void 0===s?{}:s,attributes:function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(o,["className","style"]),children:n}}function g(e,t,n){e!==t&&n(e,t)}var h=t("\n:host {\n    position: fixed;\n    display: none;\n    border: 1px solid #4af;\n    background: rgba(68, 170, 255, 0.5);\n    z-index: 100;\n}\n"),p="selecto-selection "+h.className,n={target:null,container:null,dragContainer:null,selectableTargets:Array,selectByClick:Boolean,selectFromInside:Boolean,continueSelect:Boolean,toggleContinueSelect:Array,keyContainer:null,hitRate:Number},m=["selectableTargets","selectByClick","selectFromInside","continueSelect","toggleContinueSelect","keyContainer","hitRate"],r=function(t){function e(){this.constructor=n}var n,r;function o(e){void 0===e&&(e={});var p=t.call(this)||this;return p.selectedTargets=[],p.differ=new y,p.onDragStart=function(e,t){var n=e.datas,r=e.clientX,o=e.clientY,i=e.inputEvent,s=p.options,a=s.continueSelect,l=s.selectFromInside,c=p.getSelectableTargets(),u=c.map(function(e){var t=e.getBoundingClientRect(),n=t.left,r=t.top;return{left:n,top:r,right:n+t.width,bottom:r+t.height}});n.selectableTargets=c,n.selectableRects=u,n.startSelectedTargets=p.selectedTargets;var d=t||document.elementFromPoint(r,o),g=p.hitTest({left:r,top:o,right:r,bottom:o},r,o,c,u).filter(function(e){return e===d||e.contains(d)}),f=0<g.length;a?g=p.getSelectedTargets(g):p.selectedTargets=[];var h=i.type;return!(("mousedown"===h||"touchstart"===h)&&!p.trigger("dragStart",e))&&(p.select(g,i,!0),n.startX=r,n.startY=o,n.selectedTargets=g,p.target.style.cssText+="left:"+r+"px;top:"+o+"px",!(!l&&f)||(p.onDragEnd(e),i.preventDefault(),!1))},p.onDrag=function(e){var t=e.distX,n=e.distY,r=e.datas,o=e.inputEvent,i=r.startX,s=r.startY,a=Math.min(0,t),l=Math.min(0,n),c=Math.abs(t),u=Math.abs(n);p.target.style.cssText+="display: block;transform: translate("+a+"px, "+l+"px);width:"+c+"px;height:"+u+"px;";var d=i+a,g=s+l,f=p.hitTest({left:d,top:g,right:d+c,bottom:g+u},r.startX,r.startY,r.selectableTargets,r.selectableRects),h=p.getSelectedTargets(f);p.select(h,o),r.selectedTargets=h},p.onDragEnd=function(e){var t=e.datas,n=e.inputEvent;p.target.style.cssText+="display: none;",p.selecteEnd(t.startSelectedTargets,t.selectedTargets,n),p.selectedTargets=t.selectedTargets},p.onKeyDown=function(e){p.sameCombiKey(e)&&(p.continueSelect=!0,p.trigger("keydown",{}))},p.onKeyUp=function(e){p.sameCombiKey(e)&&(p.continueSelect=!1,p.trigger("keyup",{}))},p.onBlur=function(){p.toggleContinueSelect&&p.continueSelect&&p.trigger("keyup",{})},p.onDocumentSelectStart=function(e){if(p.dragger.isFlag()){var t=p.dragContainer;t===window&&(t=document.documentElement),t!==e.target&&!t.contains(e.target)||e.preventDefault()}},p.target=e.target,p.container=e.container,p.options=u({target:null,container:null,dragContainer:null,selectableTargets:[],selectByClick:!0,selectFromInside:!0,hitRate:100,continueSelect:!1,toggleContinueSelect:null,keyContainer:null},e),p.initElement(),p.setKeyController(),p}c(n=o,r=t),n.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e);var i=o.prototype;return i.setSelectedTargets=function(e){this.selectedTargets=e,this.differ=new y(e)},i.setKeyContainer=function(e){var t=this,n=this.options;g(n.keyContainer,e,function(){n.keyContainer=e,t.setKeyController()})},i.setToggleContinueSelect=function(e){var t=this,n=this.options;g(n.toggleContinueSelect,e,function(){n.toggleContinueSelect=e,t.setKeyEvent()})},i.destroy=function(){this.off(),this.keycon&&this.keycon.destroy(),this.dragger.unset(),this.injectResult.destroy(),f.removeEvent(document,"selectstart",this.onDocumentSelectStart),this.keycon=null,this.dragger=null,this.injectResult=null,this.target=null,this.container=null,this.options=null},i.click=function(e,t){var n=function(e){if("touches"in e){var t=e.touches[0];return{clientX:t.clientX,clientY:t.clientY}}return{clientX:e.clientX,clientY:e.clientY}}(e),r={datas:{},clientX:n.clientX,clientY:n.clientY,inputEvent:e};this.onDragStart(r,t)&&this.onDragEnd(r)},i.setKeyController=function(){var e=this.options,t=e.keyContainer,n=e.toggleContinueSelect;this.keycon&&(this.keycon.destroy(),this.keycon=null),n&&(this.keycon=new l(t||window),this.keycon.keydown(this.onKeyDown).keyup(this.onKeyUp).on("blur",this.onBlur))},i.setKeyEvent=function(){this.options.toggleContinueSelect&&!this.keycon&&this.setKeyController()},i.initElement=function(){this.target=function n(e,t,r){var o=e.tag,i=e.children,s=e.attributes,a=e.className,l=e.style,c=t||document.createElement(o);for(var u in s)c.setAttribute(u,s[u]);var d=c.children;if(i.forEach(function(e,t){n(e,d[t],c)}),a&&a.split(" ").forEach(function(e){f.hasClass(c,e)||f.addClass(c,e)}),l){var g=c.style;for(var u in l)g[u]=l[u]}return!t&&r&&r.appendChild(c),c}(d("div",{className:p}),this.target,this.container);var e=this.target;this.dragContainer=this.options.dragContainer||this.target.parentNode,this.dragger=new s(this.dragContainer,{container:window,preventDefault:!1,dragstart:this.onDragStart,drag:this.onDrag,dragend:this.onDragEnd}),f.addEvent(document,"selectstart",this.onDocumentSelectStart),this.injectResult=h.inject(e)},i.hitTest=function(e,f,h,p,t){var n=this.options,y=n.hitRate,m=n.selectByClick,v=e.left,b=e.top,S=e.right,C=e.bottom,T=[];return t.forEach(function(e,t){var n=e.left,r=e.top,o=e.right,i=e.bottom,s=n<=f&&f<=o&&r<=h&&h<=i,a=(o-n)*(i-r),l=Math.max(n,v),c=Math.min(o,S),u=Math.max(r,b),d=Math.min(i,C);if(m&&s)T.push(p[t]);else if(!(c<l||d<u)){var g=Math.round((c-l)*(d-u)/a*100);y<=g&&T.push(p[t])}}),T},i.getSelectableTargets=function(){var t=[];return this.options.selectableTargets.forEach(function(e){f.isObject(e)?t.push(e):[].slice.call(document.querySelectorAll(e)).forEach(function(e){t.push(e)})}),t},i.getSelectedTargets=function(e){var t=y.diff(this.selectedTargets,e),n=t.list,r=t.prevList,o=t.added,i=t.removed;return o.map(function(e){return n[e]}).concat(i.map(function(e){return r[e]}))},i.select=function(e,t,n){var r=this.differ.update(e),o=r.added,i=r.removed,s=r.prevList,a=r.list;n&&this.trigger("selectStart",{selected:e,added:o.map(function(e){return a[e]}),removed:i.map(function(e){return s[e]}),inputEvent:t}),(o.length||i.length)&&this.trigger("select",{selected:e,added:o.map(function(e){return a[e]}),removed:i.map(function(e){return s[e]}),inputEvent:t})},i.selecteEnd=function(e,t,n){var r=y.diff(e,t),o=r.added,i=r.removed,s=r.prevList,a=r.list,l=y.diff(this.selectedTargets,t),c=l.added,u=l.removed,d=l.prevList,g=l.list,f=n.type,h="mousedown"===f||"touchstart"===f;this.trigger("selectEnd",{selected:t,added:o.map(function(e){return a[e]}),removed:i.map(function(e){return s[e]}),afterAdded:c.map(function(e){return g[e]}),afterRemoved:u.map(function(e){return d[e]}),isDragStart:h,inputEvent:n})},i.sameCombiKey=function(e){var t=[].concat(this.options.toggleContinueSelect),n=l.getCombi(e.inputEvent,e.key);return t.every(function(e){return-1<n.indexOf(e)})},o=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(i<3?o(s):3<i?o(t,n,s):o(t,n))||s);return 3<i&&s&&Object.defineProperty(t,n,s),s}([a.Properties(m,function(e,t){var n={enumerable:!0,configurable:!0,get:function(){return this.options[t]}},r=f.camelize("set "+t);e[r]?n.set=function(e){this[r](e)}:n.set=function(e){this.options[t]=e},Object.defineProperty(e,t,n)})],o)}(e),o={__proto__:null,default:r,OPTIONS:["dragContainer","selectableTargets","selectByClick","selectFromInside","continueSelect","toggleContinueSelect","keyContainer","hitRate"],OPTION_TYPES:n,PROPERTIES:m,EVENTS:["dragStart","selectStart","select","selectEnd","keydown","keyup"],METHODS:["click","setSelectedTargets"],CLASS_NAME:p};for(var i in o)r[i]=o[i];return r});
//# sourceMappingURL=selecto.min.js.map
